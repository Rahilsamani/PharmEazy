@model PharmEazy.Models.DTO.InvoiceDTO

@{
	bool isAdmin = User?.IsInRole("Admin") ?? false;
}

@if (isAdmin && Model.Status == "Pending")
{
	<div class="d-flex justify-content-end align-items-baseline gap-3" id="markAsPaidContainer">
		<b>Order Delievered? </b>
		<button id="PaidBtn" class="btn btn-success">Mark As Paid</button>
	</div>
}

<section class="h-100 gradient-custom">
	<div class="container py-5 h-100">
		<div class="row d-flex justify-content-center align-items-center h-100">
			<div class="col-lg-10 col-xl-8">
				<div class="card" style="border-radius: 10px;">
					<div class="card-header px-4 py-5">
						<h5 class="text-muted mb-0">Thanks for your Order</h5>
					</div>
					<div class="card-body p-4">
						<div class="d-flex justify-content-between align-items-center mb-4">
							<p class="lead fw-normal mb-0" style="color: #a8729a;">Invoice</p>
							<p id="invoiceStatus" class="small text-muted mb-0">@Model.Status</p>
						</div>


						<div class="card shadow-0 border mb-4">
							<div class="card-body">
								<div class="row">
									<div class="text-center col-md-2">
										<b>Image</b>
									</div>
									<div class="text-center col-md-2">
										<b>Name</b>
									</div>
									<div class="text-center col-md-2">
										<b>Description</b>
									</div>
									<div class="text-center col-md-2">
										<b>Expiry Date</b>
									</div>
									<div class="text-center col-md-2">
										<b>Quantity</b>
									</div>
									<div class="text-center col-md-2">
										<b>Price</b>
									</div>
								</div>
							</div>
							<hr />
							@foreach (var invoiceDetail in Model.InvoiceDetails)
							{
								<div class="card-body">
									<div class="row">
										<div class="col-md-2">
											<img src="/Images/@invoiceDetail.ImageUrl" class="img-fluid" alt="Phone">
										</div>
										<div class="col-md-2 text-center d-flex justify-content-center align-items-center">
											<p class="text-muted mb-0">@invoiceDetail.Name</p>
										</div>
										<div class="col-md-2 text-center d-flex justify-content-center align-items-center">
											<p class="text-muted mb-0 small">@invoiceDetail.Description</p>
										</div>
										<div class="col-md-2 text-center d-flex justify-content-center align-items-center">
											<p class="text-muted mb-0 small">@invoiceDetail.ExpiryDate.ToString("dd/MM/yyyy")</p>
										</div>
										<div class="col-md-2 text-center d-flex justify-content-center align-items-center">
											<p class="text-muted mb-0 small"> @invoiceDetail.Quantity</p>
										</div>
										<div class="col-md-2 text-center d-flex justify-content-center align-items-center">
											<p class="text-muted mb-0 small">₹@invoiceDetail.Price</p>
										</div>
									</div>
								</div>
							}
						</div>

						<div class="d-flex justify-content-between pt-2">
							<p class="fw-bold mb-0">Order Details</p>
							<p class="text-muted mb-0"><span class="fw-bold me-4">Seller Details</span></p>
						</div>

						<div class="d-flex justify-content-between pt-2">
							<p class="text-muted mb-0">Invoice Number : @Model.Id</p>
							<p class="text-muted mb-0"><span class="fw-bold me-4">Name</span> @Model.Name</p>
						</div>

						<div class="d-flex justify-content-between">
							<p class="text-muted mb-0">Invoice Date : @Model.CreatedOn.ToString("dd/MM/yyyy")</p>
							<p class="text-muted mb-0"><span class="fw-bold me-4">GST Number</span> @Model.GstNumber</p>
						</div>

						<div class="d-flex justify-content-between mb-5">
							<p class="text-muted mb-0"></p>
							<p class="text-muted mb-0"><span class="fw-bold me-4">Phone Number</span> @Model.PhoneNumber</p>
						</div>
					</div>
					<div class="card-footer border-0 px-4 py-5"
						 style="background-color: #4169e1; border-bottom-left-radius: 10px; border-bottom-right-radius: 10px;">
						<h5 class="d-flex align-items-center justify-content-end text-white text-uppercase mb-0">
							Total
							paid: <span class="h2 mb-0 ms-2">₹@Model.TotalAmount</span>
						</h5>
					</div>
				</div>
			</div>
		</div>
	</div>
</section>

@section Scripts {
	<script>
		$("#PaidBtn").on("click", function(){
			var id = @Model.Id

			$.ajax({
				type: "POST",
				url: "/Orders/UpdateStatus/"+id,
				success: function(result){
					notyf.dismissAll();
					if(result.success==true){
						notyf.success(result.message);
						$("#invoiceStatus").text("Paid");
						$("#markAsPaidContainer").remove();
					}else{
						notyf.error(result.message);
					}
				}
			});
		})
	</script>
}
